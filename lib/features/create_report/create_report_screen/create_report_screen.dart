import 'dart:developer';import 'dart:io';import 'package:dotted_decoration/dotted_decoration.dart';import 'package:flutter/material.dart';import 'package:get/get.dart';import 'package:tracenac/core/utils/app_color.dart';import 'package:tracenac/features/local_database/controller/employee_local_db_controller.dart';import 'package:tracenac/features/local_database/controller/partner_local_db_controller.dart';import '../../assets/assets_model_class/assets_model_class.dart';import '../../partner/model_class/PartnerModelClass.dart';import '../../report_template/controller/report_template_controller.dart';import 'finalize_report.dart';class CreateReportScreen extends StatefulWidget {  int? editIndex;  String? partnerIndex, employeeIndex;  CreateReportScreen({    super.key,    this.editIndex,    this.employeeIndex,    this.partnerIndex,  });  @override  State<CreateReportScreen> createState() => _CreateReportScreenState();}class _CreateReportScreenState extends State<CreateReportScreen>    with SingleTickerProviderStateMixin {  late TabController _tabController;  String? selectedOption;  String? selectedValue;  String? selectedPartner;  String linerProgress = "33";  double progressValue = 0.3;  final ReportTemplateController controller = Get.put(ReportTemplateController(),);  final PartnerLocalDbController localDbController = Get.put(PartnerLocalDbController(),);  final EmployeeLocalDbController employeeLocalDbController = Get.put(EmployeeLocalDbController());  @override  void initState() {    // TODO: implement initState    super.initState();    controller.partnerIndex.value = widget.partnerIndex ?? "";    controller.employeeIndex.value = widget.employeeIndex ?? "";    log("widget.partnerIndex==>${widget.partnerIndex}");    log("controller.partnerIndex.value==>${controller.partnerIndex.value}");    log("widget.employeeIndex==>${widget.employeeIndex}");    log("controller.employeeIndex.value==>${controller.employeeIndex.value}");    _tabController = TabController(length: 4, vsync: this);    WidgetsBinding.instance.addPostFrameCallback((_) {      localDbController.loadData();      employeeLocalDbController.loadData();      loadReportTemplateApi();    });  }  Future<void> loadReportTemplateApi() async {    await controller.reportTemplateApi();    log("widget.editIndex ==> ${widget.editIndex!}");    if (widget.editIndex != null) {      if(widget.partnerIndex != "") {        final local = localDbController.dataList[widget.editIndex!];        controller.editIndex.value = widget.editIndex!;        controller.assetIdText.value = local.assetID.toString();        controller.reportName.value = local.reportName.toString();        selectedOption = local.reportName.toString();        controller.productType.value = local.productType.toString();        selectedValue = local.productType.toString();        await loadProductData();        controller.assetsIDController.text = local.systemGeneratedAssetId.toString();        controller.assetsCodeController.text = local.systemGeneratedAssetCode.toString();        controller.assetsNameController.text = local.systemGeneratedAssetName.toString();        controller.assetsTypeController.text = local.systemGeneratedAssetType.toString();        controller.selectedAssetsName?.value = local.systemGeneratedAssetName.toString();        controller.selectedPartnerName?.value = local.systemGeneratedPartnerName.toString();        controller.partnerIDController.text = local.systemGeneratedPartnerId.toString();        controller.partnerNameController.text = local.systemGeneratedPartnerName.toString();        controller.partnerPinCodeController.text = local.systemGeneratedPartnerPinCode.toString();        controller.partnerCategoryController.text = local.systemGeneratedPartnerCategory.toString();        controller.productNameController.text = local.productName.toString();        controller.productImage.value = local.productImageFile.toString();        controller.assignTo.value = local.assignTo.toString();        log("controller.editIndex?.value==> ${controller.editIndex.value}");        log("controller.assetIdText.value==> ${controller.assetIdText.value}");        log("controller.reportName.value==> ${controller.reportName.value}");        log("controller.productType.value==> ${controller.productType.value}");        log("controller.assetsIDController.text==> ${controller.assetsIDController.text}");        log("controller.assetsCodeController.text==> ${controller.assetsCodeController.text}");        log("controller.assetsNameController.text==> ${controller.assetsNameController.text}",);        log("controller.assetsTypeController.text==> ${controller.assetsTypeController.text}",);        log("controller.selectedAssetsName?.value==> ${controller.selectedAssetsName?.value}",);        log("controller.selectedPartnerName?.value==> ${controller.selectedPartnerName?.value}",);        log("controller.partnerIDController.text==> ${controller.partnerIDController.text}",);        log("controller.partnerNameController.text==> ${controller.partnerNameController.text}",);        log("controller.partnerPinCodeController.text==> ${controller.partnerPinCodeController.text}",);        log("controller.partnerCategoryController.text==> ${controller.partnerCategoryController.text}",);        log("controller.productNameController.text==> ${controller.productNameController.text}",);        log("controller.productImage.value==> ${controller.productImage.value}");        log("controller.assignTo.value==> ${controller.assignTo.value}");      }else{        final local = employeeLocalDbController.dataList[widget.editIndex!];        controller.editIndex.value = widget.editIndex!;        // controller.firstAssetsIDController.text = local.assetID.toString();        controller.assetIdText.value = local.assetID.toString();        controller.reportName.value = local.reportName.toString();        selectedOption = local.reportName.toString();        controller.productType.value = local.productType.toString();        selectedValue = local.productType.toString();        await loadProductData();        controller.assetsIDController.text = local.systemGeneratedAssetId.toString();        controller.assetsCodeController.text = local.systemGeneratedAssetCode.toString();        controller.assetsNameController.text = local.systemGeneratedAssetName.toString();        controller.assetsTypeController.text = local.systemGeneratedAssetType.toString();        controller.selectedAssetsName?.value = local.systemGeneratedAssetName.toString();        controller.selectedPartnerName?.value = local.systemGeneratedPartnerName.toString();        controller.partnerIDController.text = local.systemGeneratedPartnerId.toString();        controller.partnerNameController.text = local.systemGeneratedPartnerName.toString();        controller.partnerPinCodeController.text = local.systemGeneratedPartnerPinCode.toString();        controller.partnerCategoryController.text = local.systemGeneratedPartnerCategory.toString();        controller.productNameController.text = local.productName.toString();        controller.productImage.value = local.productImageFile.toString();        controller.assignTo.value = local.assignTo.toString();        log("controller.editIndex?.value==> ${controller.editIndex.value}");        log("controller.assetIdText.value==> ${controller.assetIdText.value}");        log("controller.reportName.value==> ${controller.reportName.value}");        log("controller.productType.value==> ${controller.productType.value}");        log("controller.assetsIDController.text==> ${controller.assetsIDController.text}");        log("controller.assetsCodeController.text==> ${controller.assetsCodeController.text}");        log("controller.assetsNameController.text==> ${controller.assetsNameController.text}");        log("controller.assetsTypeController.text==> ${controller.assetsTypeController.text}",);        log("controller.selectedAssetsName?.value==> ${controller.selectedAssetsName?.value}",);        log("controller.selectedPartnerName?.value==> ${controller.selectedPartnerName?.value}",);        log("controller.partnerIDController.text==> ${controller.partnerIDController.text}",);        log("controller.partnerNameController.text==> ${controller.partnerNameController.text}",);        log("controller.partnerPinCodeController.text==> ${controller.partnerPinCodeController.text}",);        log("controller.partnerCategoryController.text==> ${controller.partnerCategoryController.text}",);        log("controller.productNameController.text==> ${controller.productNameController.text}",);        log("controller.productImage.value==> ${controller.productImage.value}");        log("controller.assignTo.value==> ${controller.assignTo.value}");      }    } else {      controller.fieldList.clear();      controller.systemGeneratedFields.clear();      controller.editIndex.value = null;      controller.firstAssetsIDController.clear();      controller.reportName.value = "";      controller.productType.value = "";      controller.selectedAssetsName?.value = "";      controller.selectedPartnerName?.value = "";      controller.assignTo.value = "";      controller.assetsIDController.clear();      controller.assetsCodeController.clear();      controller.assetsNameController.clear();      controller.assetsTypeController.clear();      controller.partnerIDController.clear();      controller.partnerNameController.clear();      controller.partnerPinCodeController.clear();      controller.partnerCategoryController.clear();      controller.productNameController.clear();      controller.imageFile = null;    }  }  Future<void> loadProductData() async {    if (controller.reportName.value == "") return;    controller.clearAllFieldController();    final selectedItem = controller.reportList.first.firstWhere(      (item) =>          item['name']?.toString().trim() == controller.reportName.value.trim(),      orElse: () => null,    );    if (selectedItem != null) {      final reportType = selectedItem['reportType'];      final reportId =          (reportType != null &&                  reportType is Map &&                  reportType.containsKey('_id'))              ? reportType['_id'].toString()              : '';      final reason = selectedItem['reason'];      // Update all values      selectedOption = selectedItem['name'];      // reportTextEdit.text = selectedItem['name'];      controller.reportID.value = reportId;      controller.fieldList.clear();      controller.systemGeneratedFields.clear();      if (reason != null) {        controller.fieldList.addAll(reason['fields'] ?? []);        controller.systemGeneratedFields.addAll(          reason['systemGeneratedFields'] ?? [],        );      }      log("controller.fieldList==> ${controller.fieldList}");      log("reportId====> $reportId");      controller.getPartener("");      controller.getAssetsApi("");    }    setState(() {}); // not remove screen update  }  @override  void dispose() {    // TODO: implement dispose    super.dispose();  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(title: Text("Create Report",style: TextStyle(fontFamily: "Proxima", ),)),      body: Obx(        () =>            controller.isLoading.value                ? Center(child: CircularProgressIndicator())                : Padding(                  padding: const EdgeInsets.symmetric(horizontal: 18.0),                  child: Column(                    crossAxisAlignment: CrossAxisAlignment.start,                    children: [                      SizedBox(height: MediaQuery.of(context).padding.top),                      SizedBox(height: 10),                      Padding(                        padding: EdgeInsets.symmetric(horizontal: 16.0),                        child: RichText(                          text: TextSpan(                            children: [                              TextSpan(                                text: "Report completion:  ",                                style: TextStyle(                                  fontWeight: FontWeight.bold,                                  fontFamily: "Proxima",                                  fontSize: 13,                                  color: Colors.black,                                ),                              ),                              TextSpan(                                text: "$linerProgress%",                                style: TextStyle(                                  fontFamily: "Proxima",                                  fontWeight: FontWeight.bold,                                  color: Colors.blue,                                ),                              ),                            ],                          ),                        ),                      ),                      SizedBox(height: 10),                      Padding(                        padding: EdgeInsets.symmetric(                          horizontal: 16.0,                          vertical: 10,                        ),                        child: LinearProgressIndicator(                          value: progressValue,                          // value: linerProgress,                          minHeight: 10,                          borderRadius: BorderRadius.circular(15),                          backgroundColor: Colors.blue.shade100,                          valueColor: AlwaysStoppedAnimation<Color>(                            Colors.blue,                          ),                        ),                      ),                      Padding(                        padding: const EdgeInsets.symmetric(                          vertical: 18.0,                          horizontal: 0.0,                        ),                        child: IgnorePointer(                          ignoring: true,                            child: TabBar(                          controller: _tabController,                          dividerHeight: 10,                          isScrollable: true,                          unselectedLabelColor: AppColor.appBarColor,                          labelColor: Colors.black,                          indicatorSize: TabBarIndicatorSize.tab,                          tabs: const [                            Padding(                              padding: EdgeInsets.symmetric(vertical: 8.0),                              child: Row(                                children: [                                  // Icon(                                  //   Icons.my_library_books_sharp,                                  //   size: 20,                                  // ),                                  Text(                                    "Product Details",                                    style: TextStyle(                                      fontSize: 14,                                      fontFamily: "Proxima",                                      fontWeight: FontWeight.bold,                                    ),                                  ),                                ],                              ),                            ),                            Padding(                              padding: EdgeInsets.symmetric(vertical: 8.0),                              child: Row(                                mainAxisAlignment: MainAxisAlignment.center,                                children: [                                  Text(                                    "System Data",                                    style: TextStyle(                                      fontSize: 14,                                      fontFamily: "Proxima",                                      fontWeight: FontWeight.bold,                                    ),                                  ),                                ],                              ),                            ),                            Padding(                              padding: EdgeInsets.symmetric(vertical: 8.0),                              child: Row(                                mainAxisAlignment: MainAxisAlignment.center,                                children: [                                  Text(                                    "Review",                                    style: TextStyle(                                      fontSize: 14,                                      fontFamily: "Proxima",                                      fontWeight: FontWeight.bold,                                    ),                                  ),                                ],                              ),                            ),                            Padding(                              padding: EdgeInsets.symmetric(vertical: 8.0),                              child: Row(                                mainAxisAlignment: MainAxisAlignment.center,                                children: [                                  Text(                                    "Finalize",                                    style: TextStyle(                                      fontSize: 14,                                      fontFamily: "Proxima",                                      fontWeight: FontWeight.bold,                                    ),                                  ),                                ],                              ),                            ),                          ],                        )),                      ),                      Expanded(                        child: TabBarView(                          controller: _tabController,                          physics: NeverScrollableScrollPhysics(),                          children: [                            // ProductDetails(),                            SingleChildScrollView(                              child: Column(                                crossAxisAlignment: CrossAxisAlignment.start,                                children: [                                  Text(                                    "Asset ID",                                    style: const TextStyle(                                      fontWeight: FontWeight.w600,                                      fontFamily: "Proxima",                                      fontSize: 14,                                    ),                                  ),                                  const SizedBox(height: 4),                                  TextFormField(                                    // controller: controller.firstAssetsIDController,                                    initialValue: controller.assetIdText.value,                                    onChanged: (val){                                      controller.assetIdText.value = val;                                      log("controller.assetIdText.value=====> ${controller.assetIdText.value}");                                    },                                    style: TextStyle(fontFamily: "Proxima",),                                    decoration: InputDecoration(                                      hintText: "Enter asset ID",                                      border: OutlineInputBorder(                                        borderRadius: BorderRadius.circular(8),                                        borderSide: BorderSide(                                          color: Colors.grey.shade300,                                        ),                                      ),                                      filled: true,                                      fillColor: Colors.white,                                    ),                                  ),                                  const SizedBox(height: 10),                                  Text(                                    "Report Name",                                    style: const TextStyle(                                      fontWeight: FontWeight.w600,                                      fontFamily: "Proxima",                                      fontSize: 14,                                    ),                                  ),                                  const SizedBox(height: 4),                                  Obx(() {                                    if (controller.isLoading.value) {                                      return Center(                                        child: CircularProgressIndicator(),                                      );                                    }                                    if (controller.reportList.isEmpty ||                                        controller.reportList.first.isEmpty) {                                      return Text('No reports available',                                        style: TextStyle(fontFamily: "Proxima",),);                                    }                                    // Extract unique item names (avoid duplicates)                                    final List<String> itemNames =                                        controller.reportList.first                                            .map<String>(                                              (item) =>                                                  item['name']                                                      ?.toString()                                                      .trim() ??                                                  'Unnamed',                                            )                                            .toSet() // avoid duplicates                                            .toList();                                    debugPrint("Dropdown Items: $itemNames");                                    debugPrint(                                      "Selected Option: $selectedOption",                                    );                                    // Check if selectedOption is valid                                    final dropdownValue = (selectedOption != null && itemNames.contains(selectedOption!.trim(),)) ? selectedOption!.trim() : null;                                    return DropdownButtonFormField<String>(                                      value: dropdownValue,                                      hint: Text('Select Report'),                                      style: TextStyle(                                        fontWeight: FontWeight.w400,                                        fontFamily: "Proxima",                                        fontSize: 14,                                        color: Colors.black,                                      ),                                      isExpanded: true,                                      decoration: InputDecoration(                                        contentPadding: EdgeInsets.symmetric(                                          horizontal: 12,                                          vertical: 16,                                        ),                                        border: OutlineInputBorder(                                          borderRadius: BorderRadius.circular(                                            8,                                          ),                                        ),                                      ),                                      onChanged: (String? newValue) {                                        if (newValue == null) return;                                        controller.reportName.value = newValue;                                        controller.clearAllFieldController();                                        final selectedItem = controller                                            .reportList                                            .first                                            .firstWhere(                                              (item) =>                                                  item['name']                                                      ?.toString()                                                      .trim() ==                                                  controller.reportName.value                                                      .trim(),                                              orElse: () => null,                                            );                                        if (selectedItem != null) {                                          final reportType =                                              selectedItem['reportType'];                                          final reportId =                                              (reportType != null &&                                                      reportType is Map &&                                                      reportType.containsKey(                                                        '_id',                                                      ))                                                  ? reportType['_id'].toString()                                                  : '';                                          final reason = selectedItem['reason'];                                          // Update all values                                          selectedOption = selectedItem['name'];                                          // reportTextEdit.text = selectedItem['name'];                                          controller.reportID.value = reportId;                                          controller.fieldList.clear();                                          controller.systemGeneratedFields                                              .clear();                                          if (reason != null) {                                            controller.fieldList.addAll(                                              reason['fields'] ?? [],                                            );                                            controller.systemGeneratedFields.addAll(                                              reason['systemGeneratedFields'] ??                                                  [],                                            );                                          }                                          log(                                            "controller.fieldList==> ${controller.fieldList}",                                          );                                          log("reportId====> $reportId");                                          controller.getPartener("");                                          controller.getAssetsApi("");                                        }                                        setState(                                          () {},                                        ); // not remove screen update                                      },                                      items:                                          itemNames.map((name) {                                            return DropdownMenuItem<String>(                                              value: name,                                              child: Text(                                                name,                                                style: TextStyle(fontSize: 14),                                              ),                                            );                                          }).toList(),                                    );                                  }),                                  if (controller.fieldList.isEmpty) ...[                                    Center(child: Text('')),                                  ],                                  if (controller.fieldList.isNotEmpty) ...[                                    ListView.builder(                                      itemCount: controller.fieldList.length,                                      shrinkWrap: true,                                      physics: NeverScrollableScrollPhysics(),                                      itemBuilder: (context, index) {                                        controller.selectOptionList.clear();                                        controller.selectOptionList.add(                                          controller                                              .fieldList[index]['options'],                                        );                                        log(                                          "controller.selectOptionList${controller.selectOptionList}",                                        );                                        List typeList =                                            controller.selectOptionList.first;                                        log("typeList==> $typeList");                                        return Column(                                          crossAxisAlignment:                                              CrossAxisAlignment.start,                                          children: [                                            const SizedBox(height: 10),                                            Text(                                              controller                                                  .fieldList[index]['name'],                                              style: const TextStyle(                                                fontWeight: FontWeight.w600,                                                fontFamily: "Proxima",                                                fontSize: 14,                                              ),                                            ),                                            const SizedBox(height: 4),                                            if (controller                                                    .fieldList[index]['type'] ==                                                "text") ...[                                              TextFormField(                                                controller:                                                    controller                                                        .productNameController,                                                style: TextStyle(                                                  fontWeight: FontWeight.w400,                                                  fontFamily: "Proxima",                                                  fontSize: 14,                                                  color: Colors.black,                                                ),                                                decoration: InputDecoration(                                                  hintText:                                                      "Enter Product Name",                                                  hintStyle: TextStyle(                                                    fontSize: 14,                                                    fontWeight: FontWeight.w400,                                                  ),                                                  border: OutlineInputBorder(                                                    borderRadius:                                                        BorderRadius.circular(                                                          15,                                                        ),                                                  ),                                                ),                                              ),                                              // SizedBox(height: 10),                                            ],                                            if (controller                                                    .fieldList[index]['type'] ==                                                "upload") ...[                                              InkWell(                                                onTap: () async {                                                  final pickedFile =                                                      await controller                                                          .pickImageFromGallery();                                                  if (pickedFile != null) {                                                    setState(() {});                                                  }                                                },                                                child: Container(                                                  height: 100,                                                  width: 100,                                                  decoration: DottedDecoration(                                                    shape: Shape.box,                                                  ),                                                  child:                                                      controller                                                                  .productImage                                                                  .value !=                                                              ""                                                          ? Image.file(                                                            File(                                                              controller                                                                  .productImage                                                                  .value,                                                            ),                                                            fit: BoxFit.cover,                                                          )                                                          : Icon(Icons.add),                                                ),                                              ),                                              // SizedBox(height: 20),                                            ],                                            if (controller                                                    .fieldList[index]['type'] ==                                                "select") ...[                                              DropdownButtonFormField<String>(                                                value: selectedValue,                                                decoration: InputDecoration(                                                  // labelText: "Select Type",                                                  border: OutlineInputBorder(                                                    borderRadius:                                                        BorderRadius.circular(                                                          15,                                                        ),                                                  ),                                                ),                                                style: TextStyle(                                                  fontWeight: FontWeight.w400,                                                  fontFamily: "Proxima",                                                  fontSize: 14,                                                  color: Colors.black,                                                ),                                                items:                                                    typeList.map((type) {                                                      return DropdownMenuItem<                                                        String                                                      >(                                                        value: type,                                                        child: Text(type),                                                      );                                                    }).toList(),                                                onChanged: (value) {                                                  setState(() {                                                    selectedValue = value;                                                    controller                                                        .productType                                                        .value = value!;                                                  });                                                },                                                hint: Text("Choose a type"),                                              ),                                            ],                                          ],                                        );                                      },                                    ),                                  ],                                  const SizedBox(height: 24),                                  SizedBox(                                    width: double.infinity,                                    child: ElevatedButton(                                      style: ElevatedButton.styleFrom(                                        padding: const EdgeInsets.symmetric(                                          vertical: 16,                                        ),                                        shape: RoundedRectangleBorder(                                          borderRadius: BorderRadius.circular(                                            12,                                          ),                                        ),                                      ),                                      onPressed: () {                                        if (_tabController.index < _tabController.length - 1) {                                          setState(() {                                            linerProgress = "60";                                            progressValue = 0.6;                                          });                                          _tabController.animateTo(_tabController.index + 1,);                                        }                                      },                                      child: const Text("Next", style:                                      TextStyle(fontFamily: "Proxima", fontWeight: FontWeight.bold),),                                    ),                                  ),                                  SizedBox(height: 20,),                                ],                              ),                            ),                            SingleChildScrollView(                              child: Column(                                crossAxisAlignment: CrossAxisAlignment.start,                                children: [                                  if (controller                                      .systemGeneratedFields                                      .isEmpty) ...[                                    Center(child: Text('Not Field', style: TextStyle(fontFamily: "Proxima",),)),                                  ],                                  if (controller                                      .systemGeneratedFields                                      .isNotEmpty) ...[                                    ListView.builder(                                      itemCount:                                          controller                                              .systemGeneratedFields                                              .length,                                      shrinkWrap: true,                                      physics: NeverScrollableScrollPhysics(),                                      itemBuilder: (context, index) {                                        return Column(                                          crossAxisAlignment:                                              CrossAxisAlignment.start,                                          children: [                                            ...List.generate(                                              controller                                                  .systemGeneratedFields[index]['fields']                                                  .length,                                              (fieldIndex) => Column(                                                crossAxisAlignment:                                                    CrossAxisAlignment.start,                                                children: [                                                  Text("${controller.systemGeneratedFields[index]['fields'][fieldIndex]}",style: const TextStyle(                                                    fontWeight: FontWeight.w600,                                                    fontFamily: "Proxima",                                                    fontSize: 14,                                                  ),),                                                  if (controller                                                          .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "assetId") ...[                                                    Builder(                                                      builder: (context) {                                                        final assetsList =                                                            controller                                                                .assetsModelClass                                                                ?.asetsMsg ??                                                            [];                                                        final dropdownValue =                                                            assetsList.firstWhere(                                                              (e) =>                                                                  e.assetName ==                                                                  controller                                                                      .selectedAssetsName                                                                      ?.value,                                                              orElse:                                                                  () =>                                                                      assetsList                                                                          .first,                                                            );                                                        return Column(                                                          crossAxisAlignment:                                                              CrossAxisAlignment                                                                  .start,                                                          children: [                                                            DropdownButtonFormField<                                                              AssetsMsg                                                            >(                                                              value:                                                                  dropdownValue,                                                              style: TextStyle(                                                                fontSize: 14,                                                                fontFamily: "Proxima",                                                                fontWeight:                                                                    FontWeight                                                                        .w400,                                                                color:                                                                    Colors                                                                        .black,                                                              ),                                                              items:                                                                  assetsList.map((                                                                    partner,                                                                  ) {                                                                    final displayText =                                                                        "${partner.assetId ?? 'ID'} - ${partner.assetName ?? 'N/A'}";                                                                    return DropdownMenuItem<                                                                      AssetsMsg                                                                    >(                                                                      value:                                                                          partner,                                                                      child: Text(                                                                        displayText,                                                                      ),                                                                    );                                                                  }).toList(),                                                              onChanged: (                                                                selectedPartner,                                                              ) {                                                                if (selectedPartner !=                                                                    null) {                                                                  controller                                                                          .selectedAssetsName                                                                          ?.value =                                                                      selectedPartner                                                                          .assetName ??                                                                      '';                                                                  controller                                                                          .assetsNameController                                                                          .text =                                                                      selectedPartner                                                                          .assetName ??                                                                      '';                                                                  controller                                                                          .assetsIDController                                                                          .text =                                                                      selectedPartner                                                                          .assetId ??                                                                      '';                                                                  controller                                                                          .assetsCodeController                                                                          .text =                                                                      selectedPartner                                                                          .categoryId ??                                                                      '';                                                                }                                                              },                                                              decoration: InputDecoration(                                                                hintText:                                                                    "Select Partner",                                                                border: OutlineInputBorder(                                                                  borderRadius:                                                                      BorderRadius.circular(                                                                        12,                                                                      ),                                                                ),                                                              ),                                                            ),                                                            SizedBox(                                                              height: 20,                                                            ),                                                          ],                                                        );                                                      },                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                          .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "assetName") ...[                                                    TextFormField(                                                      controller:                                                          controller                                                              .assetsNameController,                                                      style: TextStyle(                                                        fontWeight:                                                            FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                            "Enter Assets Name",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                              FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                              BorderRadius.circular(                                                                15,                                                              ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                          .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "assetCode") ...[                                                    TextFormField(                                                      controller:                                                          controller                                                              .assetsCodeController,                                                      style: TextStyle(                                                        fontWeight:                                                            FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                            "Enter Assets Code",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                              FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                              BorderRadius.circular(                                                                15,                                                              ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                          .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "assetType") ...[                                                    TextFormField(                                                      controller:                                                          controller                                                              .assetsTypeController,                                                      style: TextStyle(                                                        fontWeight:                                                            FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                            "Enter Assets Type",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                              FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                              BorderRadius.circular(                                                                15,                                                              ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                          .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "partnerId")                                                    Builder(                                                      builder: (context) {                                                        final partnerList =                                                            controller                                                                .partnerModelClass                                                                ?.msg ??                                                            [];                                                        if (partnerList                                                            .isEmpty) {                                                          return Text(                                                            "No partners available.",                                                            style: TextStyle(fontFamily: "Proxima",),                                                          );                                                        }                                                        final dropdownValue =                                                            partnerList.firstWhere(                                                              (e) =>                                                                  e.partnerName ==                                                                  controller                                                                      .selectedPartnerName                                                                      ?.value,                                                              orElse:                                                                  () =>                                                                      partnerList                                                                          .first,                                                            );                                                        return Column(                                                          crossAxisAlignment:                                                              CrossAxisAlignment                                                                  .start,                                                          children: [                                                            DropdownButtonFormField<                                                              Msg                                                            >(                                                              value:                                                                  dropdownValue,                                                              style: TextStyle(                                                                fontSize: 14,                                                                fontWeight:                                                                    FontWeight                                                                        .w400,                                                                fontFamily: "Proxima",                                                                color:                                                                    Colors                                                                        .black,                                                              ),                                                              items:                                                                  partnerList.map((                                                                    partner,                                                                  ) {                                                                    final displayText =                                                                        "${partner.partnerId ?? 'ID'} - ${partner.partnerName ?? 'N/A'}";                                                                    return DropdownMenuItem<                                                                      Msg                                                                    >(                                                                      value:                                                                          partner,                                                                      child: SizedBox(                                                                        height:                                                                            48,                                                                        child: Column(                                                                          crossAxisAlignment:                                                                              CrossAxisAlignment.start,                                                                          mainAxisAlignment:                                                                              MainAxisAlignment.center,                                                                          children: [                                                                            Text(                                                                              displayText,                                                                              overflow:                                                                                  TextOverflow.ellipsis,                                                                            ),                                                                          ],                                                                        ),                                                                      ),                                                                    );                                                                  }).toList(),                                                              onChanged: (                                                                selectedPartner,                                                              ) {                                                                if (selectedPartner !=                                                                    null) {                                                                  controller                                                                          .selectedPartnerName                                                                          ?.value =                                                                      selectedPartner                                                                          .partnerName ??                                                                      '';                                                                  controller                                                                          .partnerNameController                                                                          .text =                                                                      selectedPartner                                                                          .partnerName ??                                                                      '';                                                                  controller                                                                          .partnerIDController                                                                          .text =                                                                      selectedPartner                                                                          .partnerId ??                                                                      '';                                                                  controller                                                                          .partnerPinCodeController                                                                          .text =                                                                      selectedPartner                                                                          .pincode ??                                                                      '';                                                                }                                                              },                                                              decoration: InputDecoration(                                                                hintText:                                                                    "Select Partner",                                                                border: OutlineInputBorder(                                                                  borderRadius:                                                                      BorderRadius.circular(                                                                        12,                                                                      ),                                                                ),                                                              ),                                                            ),                                                            SizedBox(                                                              height: 20,                                                            ),                                                          ],                                                        );                                                      },                                                    ),                                                  if (controller                                                          .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "partnerName") ...[                                                    TextFormField(                                                      controller:                                                          controller                                                              .partnerNameController,                                                      style: TextStyle(                                                        fontWeight:                                                            FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                            "Enter Partner Name",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                              FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                              BorderRadius.circular(                                                                15,                                                              ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                          .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "partnerCategory") ...[                                                    TextFormField(                                                      controller:                                                          controller                                                              .partnerCategoryController,                                                      style: TextStyle(                                                        fontWeight:                                                            FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                            "Enter Partner Category",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                              FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                              BorderRadius.circular(                                                                15,                                                              ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                          .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "pincode") ...[                                                    TextFormField(                                                      controller:                                                          controller                                                              .partnerPinCodeController,                                                      style: TextStyle(                                                        fontWeight:                                                            FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                            "Enter pin code",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                              FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                              BorderRadius.circular(                                                                15,                                                              ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                ],                                              ),                                            ),                                          ],                                        );                                      },                                    ),                                  ],                                  const SizedBox(height: 24),                                  SizedBox(                                    width: double.infinity,                                    child: ElevatedButton(                                      style: ElevatedButton.styleFrom(                                        padding: const EdgeInsets.symmetric(                                          vertical: 16,                                        ),                                        shape: RoundedRectangleBorder(                                          borderRadius: BorderRadius.circular(                                            12,                                          ),                                        ),                                      ),                                      onPressed: () {                                        if (_tabController.index <                                            _tabController.length - 1) {                                          _tabController.animateTo(                                            _tabController.index + 1,                                          );                                        }                                      },                                      child: const Text("Next", style: TextStyle(fontFamily: "Proxima",),),                                    ),                                  ),                                  SizedBox(height: 20,),                                ],                              ),                            ),                            // const SystemData(),                            SingleChildScrollView(                              child: Column(                                crossAxisAlignment: CrossAxisAlignment.start,                                children: [                                  Text(                                    "Asset ID",                                    style: const TextStyle(                                      fontWeight: FontWeight.w600,                                      fontFamily: "Proxima",                                      fontSize: 14,                                    ),                                  ),                                  const SizedBox(height: 4),                                  TextFormField(                                    // controller: controller.firstAssetsIDController,                                    initialValue: controller.assetIdText.value,                                    onChanged: (val){                                      controller.assetIdText.value = val;                                      log("controller.assetIdText.value=====> ${controller.assetIdText.value}");                                    },                                    style: TextStyle(fontFamily: "Proxima",),                                    decoration: InputDecoration(                                      hintText: "Enter asset ID",                                      border: OutlineInputBorder(                                        borderRadius: BorderRadius.circular(8),                                        borderSide: BorderSide(                                          color: Colors.grey.shade300,                                        ),                                      ),                                      filled: true,                                      fillColor: Colors.white,                                    ),                                  ),                                  const SizedBox(height: 10),                                  Text(                                    "Report Name",                                    style: const TextStyle(                                      fontWeight: FontWeight.w600,                                      fontFamily: "Proxima",                                      fontSize: 14,                                    ),                                  ),                                  const SizedBox(height: 4),                                  Obx(() {                                    if (controller.isLoading.value) {                                      return Center(                                        child: CircularProgressIndicator(),                                      );                                    }                                    if (controller.reportList.isEmpty ||                                        controller.reportList.first.isEmpty) {                                      return Text('No reports available',                                        style: TextStyle(fontFamily: "Proxima",),);                                    }                                    // Extract unique item names (avoid duplicates)                                    final List<String> itemNames =                                    controller.reportList.first                                        .map<String>(                                          (item) =>                                      item['name']                                          ?.toString()                                          .trim() ??                                          'Unnamed',                                    )                                        .toSet() // avoid duplicates                                        .toList();                                    debugPrint("Dropdown Items: $itemNames");                                    debugPrint(                                      "Selected Option: $selectedOption",                                    );                                    // Check if selectedOption is valid                                    final dropdownValue =                                    (selectedOption != null &&                                        itemNames.contains(                                          selectedOption!.trim(),                                        ))                                        ? selectedOption!.trim()                                        : null;                                    return DropdownButtonFormField<String>(                                      value: dropdownValue,                                      hint: Text('Select Report'),                                      style: TextStyle(                                        fontWeight: FontWeight.w400,                                        fontFamily: "Proxima",                                        fontSize: 14,                                        color: Colors.black,                                      ),                                      isExpanded: true,                                      decoration: InputDecoration(                                        contentPadding: EdgeInsets.symmetric(                                          horizontal: 12,                                          vertical: 16,                                        ),                                        border: OutlineInputBorder(                                          borderRadius: BorderRadius.circular(                                            8,                                          ),                                        ),                                      ),                                      onChanged: (String? newValue) {                                        if (newValue == null) return;                                        controller.reportName.value = newValue;                                        controller.clearAllFieldController();                                        final selectedItem = controller                                            .reportList                                            .first                                            .firstWhere(                                              (item) =>                                          item['name']                                              ?.toString()                                              .trim() ==                                              controller.reportName.value                                                  .trim(),                                          orElse: () => null,                                        );                                        if (selectedItem != null) {                                          final reportType =                                          selectedItem['reportType'];                                          final reportId =                                          (reportType != null &&                                              reportType is Map &&                                              reportType.containsKey(                                                '_id',                                              ))                                              ? reportType['_id'].toString()                                              : '';                                          final reason = selectedItem['reason'];                                          // Update all values                                          selectedOption = selectedItem['name'];                                          // reportTextEdit.text = selectedItem['name'];                                          controller.reportID.value = reportId;                                          controller.fieldList.clear();                                          controller.systemGeneratedFields                                              .clear();                                          if (reason != null) {                                            controller.fieldList.addAll(                                              reason['fields'] ?? [],                                            );                                            controller.systemGeneratedFields.addAll(                                              reason['systemGeneratedFields'] ??                                                  [],                                            );                                          }                                          log(                                            "controller.fieldList==> ${controller.fieldList}",                                          );                                          log("reportId====> $reportId");                                          controller.getPartener("");                                          controller.getAssetsApi("");                                        }                                        setState(                                              () {},                                        ); // not remove screen update                                      },                                      items:                                      itemNames.map((name) {                                        return DropdownMenuItem<String>(                                          value: name,                                          child: Text(                                            name,                                            style: TextStyle(fontSize: 14),                                          ),                                        );                                      }).toList(),                                    );                                  }),                                  if (controller.fieldList.isEmpty) ...[                                    Center(child: Text('')),                                  ],                                  if (controller.fieldList.isNotEmpty) ...[                                    ListView.builder(                                      itemCount: controller.fieldList.length,                                      shrinkWrap: true,                                      physics: NeverScrollableScrollPhysics(),                                      itemBuilder: (context, index) {                                        controller.selectOptionList.clear();                                        controller.selectOptionList.add(                                          controller                                              .fieldList[index]['options'],                                        );                                        log(                                          "controller.selectOptionList${controller.selectOptionList}",                                        );                                        List typeList =                                            controller.selectOptionList.first;                                        log("typeList==> $typeList");                                        return Column(                                          crossAxisAlignment:                                          CrossAxisAlignment.start,                                          children: [                                            const SizedBox(height: 10),                                            Text(                                              controller                                                  .fieldList[index]['name'],                                              style: const TextStyle(                                                fontWeight: FontWeight.w600,                                                fontFamily: "Proxima",                                                fontSize: 14,                                              ),                                            ),                                            const SizedBox(height: 4),                                            if (controller                                                .fieldList[index]['type'] ==                                                "text") ...[                                              TextFormField(                                                controller:                                                controller                                                    .productNameController,                                                style: TextStyle(                                                  fontWeight: FontWeight.w400,                                                  fontFamily: "Proxima",                                                  fontSize: 14,                                                  color: Colors.black,                                                ),                                                decoration: InputDecoration(                                                  hintText:                                                  "Enter Product Name",                                                  hintStyle: TextStyle(                                                    fontSize: 14,                                                    fontWeight: FontWeight.w400,                                                  ),                                                  border: OutlineInputBorder(                                                    borderRadius:                                                    BorderRadius.circular(                                                      15,                                                    ),                                                  ),                                                ),                                              ),                                              // SizedBox(height: 10),                                            ],                                            if (controller                                                .fieldList[index]['type'] ==                                                "upload") ...[                                              InkWell(                                                onTap: () async {                                                  final pickedFile =                                                  await controller                                                      .pickImageFromGallery();                                                  if (pickedFile != null) {                                                    setState(() {});                                                  }                                                },                                                child: Container(                                                  height: 100,                                                  width: 100,                                                  decoration: DottedDecoration(                                                    shape: Shape.box,                                                  ),                                                  child:                                                  controller                                                      .productImage                                                      .value !=                                                      ""                                                      ? Image.file(                                                    File(                                                      controller                                                          .productImage                                                          .value,                                                    ),                                                    fit: BoxFit.cover,                                                  )                                                      : Icon(Icons.add),                                                ),                                              ),                                              // SizedBox(height: 20),                                            ],                                            if (controller                                                .fieldList[index]['type'] ==                                                "select") ...[                                              DropdownButtonFormField<String>(                                                value: selectedValue,                                                decoration: InputDecoration(                                                  // labelText: "Select Type",                                                  border: OutlineInputBorder(                                                    borderRadius:                                                    BorderRadius.circular(                                                      15,                                                    ),                                                  ),                                                ),                                                style: TextStyle(                                                  fontWeight: FontWeight.w400,                                                  fontFamily: "Proxima",                                                  fontSize: 14,                                                  color: Colors.black,                                                ),                                                items:                                                typeList.map((type) {                                                  return DropdownMenuItem<                                                      String                                                  >(                                                    value: type,                                                    child: Text(type),                                                  );                                                }).toList(),                                                onChanged: (value) {                                                  setState(() {                                                    selectedValue = value;                                                    controller                                                        .productType                                                        .value = value!;                                                  });                                                },                                                hint: Text("Choose a type"),                                              ),                                            ],                                          ],                                        );                                      },                                    ),                                  ],                                  if (controller                                      .systemGeneratedFields                                      .isEmpty) ...[                                    Center(child: Text('', style: TextStyle(fontFamily: "Proxima",),)),                                  ],                                  if (controller                                      .systemGeneratedFields                                      .isNotEmpty) ...[                                    ListView.builder(                                      itemCount:                                      controller                                          .systemGeneratedFields                                          .length,                                      shrinkWrap: true,                                      physics: NeverScrollableScrollPhysics(),                                      itemBuilder: (context, index) {                                        return Column(                                          crossAxisAlignment:                                          CrossAxisAlignment.start,                                          children: [                                            ...List.generate(                                              controller                                                  .systemGeneratedFields[index]['fields']                                                  .length,                                                  (fieldIndex) => Column(                                                crossAxisAlignment:                                                CrossAxisAlignment.start,                                                children: [                                                  Text("${controller.systemGeneratedFields[index]['fields'][fieldIndex]}",style: const TextStyle(                                                    fontWeight: FontWeight.w600,                                                    fontFamily: "Proxima",                                                    fontSize: 14,                                                  ),),                                                  if (controller                                                      .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "assetId") ...[                                                    Builder(                                                      builder: (context) {                                                        final assetsList =                                                            controller                                                                .assetsModelClass                                                                ?.asetsMsg ??                                                                [];                                                        final dropdownValue =                                                        assetsList.firstWhere(                                                              (e) =>                                                          e.assetName ==                                                              controller                                                                  .selectedAssetsName                                                                  ?.value,                                                          orElse:                                                              () =>                                                          assetsList                                                              .first,                                                        );                                                        return Column(                                                          crossAxisAlignment:                                                          CrossAxisAlignment                                                              .start,                                                          children: [                                                            DropdownButtonFormField<                                                                AssetsMsg                                                            >(                                                              value:                                                              dropdownValue,                                                              style: TextStyle(                                                                fontSize: 14,                                                                fontFamily: "Proxima",                                                                fontWeight:                                                                FontWeight                                                                    .w400,                                                                color:                                                                Colors                                                                    .black,                                                              ),                                                              items:                                                              assetsList.map((                                                                  partner,                                                                  ) {                                                                final displayText =                                                                    "${partner.assetId ?? 'ID'} - ${partner.assetName ?? 'N/A'}";                                                                return DropdownMenuItem<                                                                    AssetsMsg                                                                >(                                                                  value:                                                                  partner,                                                                  child: Text(                                                                    displayText,                                                                  ),                                                                );                                                              }).toList(),                                                              onChanged: (                                                                  selectedPartner,                                                                  ) {                                                                if (selectedPartner !=                                                                    null) {                                                                  controller                                                                      .selectedAssetsName                                                                      ?.value =                                                                      selectedPartner                                                                          .assetName ??                                                                          '';                                                                  controller                                                                      .assetsNameController                                                                      .text =                                                                      selectedPartner                                                                          .assetName ??                                                                          '';                                                                  controller                                                                      .assetsIDController                                                                      .text =                                                                      selectedPartner                                                                          .assetId ??                                                                          '';                                                                  controller                                                                      .assetsCodeController                                                                      .text =                                                                      selectedPartner                                                                          .categoryId ??                                                                          '';                                                                }                                                              },                                                              decoration: InputDecoration(                                                                hintText:                                                                "Select Partner",                                                                border: OutlineInputBorder(                                                                  borderRadius:                                                                  BorderRadius.circular(                                                                    12,                                                                  ),                                                                ),                                                              ),                                                            ),                                                            SizedBox(                                                              height: 20,                                                            ),                                                          ],                                                        );                                                      },                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                      .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "assetName") ...[                                                    TextFormField(                                                      controller:                                                      controller                                                          .assetsNameController,                                                      style: TextStyle(                                                        fontWeight:                                                        FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                        "Enter Assets Name",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                          FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                          BorderRadius.circular(                                                            15,                                                          ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                      .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "assetCode") ...[                                                    TextFormField(                                                      controller:                                                      controller                                                          .assetsCodeController,                                                      style: TextStyle(                                                        fontWeight:                                                        FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                        "Enter Assets Code",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                          FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                          BorderRadius.circular(                                                            15,                                                          ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                      .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "assetType") ...[                                                    TextFormField(                                                      controller:                                                      controller                                                          .assetsTypeController,                                                      style: TextStyle(                                                        fontWeight:                                                        FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                        "Enter Assets Type",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                          FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                          BorderRadius.circular(                                                            15,                                                          ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                      .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "partnerId")                                                    Builder(                                                      builder: (context) {                                                        final partnerList =                                                            controller                                                                .partnerModelClass                                                                ?.msg ??                                                                [];                                                        if (partnerList                                                            .isEmpty) {                                                          return Text(                                                            "No partners available.",                                                            style: TextStyle(fontFamily: "Proxima",),                                                          );                                                        }                                                        final dropdownValue =                                                        partnerList.firstWhere(                                                              (e) =>                                                          e.partnerName ==                                                              controller                                                                  .selectedPartnerName                                                                  ?.value,                                                          orElse:                                                              () =>                                                          partnerList                                                              .first,                                                        );                                                        return Column(                                                          crossAxisAlignment:                                                          CrossAxisAlignment                                                              .start,                                                          children: [                                                            DropdownButtonFormField<                                                                Msg                                                            >(                                                              value:                                                              dropdownValue,                                                              style: TextStyle(                                                                fontSize: 14,                                                                fontWeight:                                                                FontWeight                                                                    .w400,                                                                fontFamily: "Proxima",                                                                color:                                                                Colors                                                                    .black,                                                              ),                                                              items:                                                              partnerList.map((                                                                  partner,                                                                  ) {                                                                final displayText =                                                                    "${partner.partnerId ?? 'ID'} - ${partner.partnerName ?? 'N/A'}";                                                                return DropdownMenuItem<                                                                    Msg                                                                >(                                                                  value:                                                                  partner,                                                                  child: SizedBox(                                                                    height:                                                                    48,                                                                    child: Column(                                                                      crossAxisAlignment:                                                                      CrossAxisAlignment.start,                                                                      mainAxisAlignment:                                                                      MainAxisAlignment.center,                                                                      children: [                                                                        Text(                                                                          displayText,                                                                          overflow:                                                                          TextOverflow.ellipsis,                                                                        ),                                                                      ],                                                                    ),                                                                  ),                                                                );                                                              }).toList(),                                                              onChanged: (                                                                  selectedPartner,                                                                  ) {                                                                if (selectedPartner !=                                                                    null) {                                                                  controller                                                                      .selectedPartnerName                                                                      ?.value =                                                                      selectedPartner                                                                          .partnerName ??                                                                          '';                                                                  controller                                                                      .partnerNameController                                                                      .text =                                                                      selectedPartner                                                                          .partnerName ??                                                                          '';                                                                  controller                                                                      .partnerIDController                                                                      .text =                                                                      selectedPartner                                                                          .partnerId ??                                                                          '';                                                                  controller                                                                      .partnerPinCodeController                                                                      .text =                                                                      selectedPartner                                                                          .pincode ??                                                                          '';                                                                }                                                              },                                                              decoration: InputDecoration(                                                                hintText:                                                                "Select Partner",                                                                border: OutlineInputBorder(                                                                  borderRadius:                                                                  BorderRadius.circular(                                                                    12,                                                                  ),                                                                ),                                                              ),                                                            ),                                                            SizedBox(                                                              height: 20,                                                            ),                                                          ],                                                        );                                                      },                                                    ),                                                  if (controller                                                      .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "partnerName") ...[                                                    TextFormField(                                                      controller:                                                      controller                                                          .partnerNameController,                                                      style: TextStyle(                                                        fontWeight:                                                        FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                        "Enter Partner Name",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                          FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                          BorderRadius.circular(                                                            15,                                                          ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                      .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "partnerCategory") ...[                                                    TextFormField(                                                      controller:                                                      controller                                                          .partnerCategoryController,                                                      style: TextStyle(                                                        fontWeight:                                                        FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                        "Enter Partner Category",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                          FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                          BorderRadius.circular(                                                            15,                                                          ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                  if (controller                                                      .systemGeneratedFields[index]['fields'][fieldIndex] ==                                                      "pincode") ...[                                                    TextFormField(                                                      controller:                                                      controller                                                          .partnerPinCodeController,                                                      style: TextStyle(                                                        fontWeight:                                                        FontWeight.w400,                                                        fontFamily: "Proxima",                                                        fontSize: 14,                                                        color: Colors.black,                                                      ),                                                      decoration: InputDecoration(                                                        hintText:                                                        "Enter pin code",                                                        hintStyle: TextStyle(                                                          fontSize: 14,                                                          fontWeight:                                                          FontWeight.w400,                                                        ),                                                        border: OutlineInputBorder(                                                          borderRadius:                                                          BorderRadius.circular(                                                            15,                                                          ),                                                        ),                                                      ),                                                    ),                                                    SizedBox(height: 20),                                                  ],                                                ],                                              ),                                            ),                                          ],                                        );                                      },                                    ),                                  ],                                  Row(                                    children: [                                      Expanded(                                        child: ElevatedButton(                                          style: ElevatedButton.styleFrom(                                            elevation: 0.0,                                            backgroundColor:                                                Colors.grey.shade300,                                            padding: const EdgeInsets.symmetric(                                              vertical: 16,                                            ),                                            shape: RoundedRectangleBorder(                                              borderRadius:                                                  BorderRadius.circular(12),                                            ),                                          ),                                          onPressed: () {},                                          child: const Text(                                            "Modify",                                            style: TextStyle(                                              fontFamily: "Proxima",                                              color: Colors.black,                                            ),                                          ),                                        ),                                      ),                                      const SizedBox(width: 24),                                      Expanded(                                        child: ElevatedButton(                                          style: ElevatedButton.styleFrom(                                            elevation: 0.0,                                            padding: const EdgeInsets.symmetric(                                              vertical: 16,                                            ),                                            shape: RoundedRectangleBorder(                                              borderRadius:                                                  BorderRadius.circular(12),                                            ),                                          ),                                          onPressed: () {                                            if (_tabController.index <                                                _tabController.length - 1) {                                              setState(() {                                                linerProgress = "90";                                                progressValue = 0.9;                                              });                                              _tabController.animateTo(                                                _tabController.index + 1,                                              );                                            }                                          },                                          child: const Text("Next", style: TextStyle(fontFamily: "Proxima",),),                                        ),                                      ),                                    ],                                  ),                                  SizedBox(height: 20,),                                ],                              ),                            ),                            // const MultiCity(),                            FinalizeReport(),                          ],                        ),                      ),                    ],                  ),                ),      ),    );  }}